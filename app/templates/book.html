{% extends "base.html" %}

{% block content %}

<h1 class="mb-3">Book: {{ room.name }}</h1>

<form method="post" novalidate aria-label="Booking form">

  {{ form.csrf_token }}
  <div class="row g-3">

    <div class="col-md-3">
      <label class="form-label" for="{{ form.start_date.id }}">Check‑in</label>
      {{ form.start_date(class="form-control", aria_label="Check-in date") }}
    </div>

    <div class="col-md-3">
      <label class="form-label" for="{{ form.end_date.id }}">Check‑out</label>
      {{ form.end_date(class="form-control", aria_label="Check-out date") }}
    </div>

    <div class="col-md-3">
      <label class="form-label" for="{{ form.guests.id }}">Guests</label>
      {{ form.guests(class="form-control", aria_label="Number of guests") }}
    </div>

    <div class="col-12">
      {{ form.submit(class="btn btn-success mt-2") }}
    </div>

  </div>

<script>
/* Guest buttons */
document.querySelectorAll(".guest-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const count = btn.dataset.count;
    /* update hidden WTForms field */
    document.getElementById("{{ form.guests.id }}").value = count;

    /* visual selection */
    btn.parentElement.querySelectorAll(".guest-btn")
       .forEach(b => b.classList.remove("is-selected"));
    btn.classList.add("is-selected");
  });
});

/* Night buttons  */
const startInput = document.getElementById("{{ form.start_date.id }}");
const endInput   = document.getElementById("{{ form.end_date.id }}");

function setCheckout(nights) {
  const start = new Date(startInput.value);
  if (!isNaN(start)) {
    const checkout = new Date(start);
    checkout.setDate(start.getDate() + nights);
    endInput.valueAsDate = checkout;
  }
}

/* update end date whenever check-in changes */
startInput.addEventListener("change", () => {
  const sel = document.querySelector(".js-nights.is-selected");
  const nights = sel ? parseInt(sel.dataset.nights) : 1;
  setCheckout(nights);
});

document.querySelectorAll(".js-nights").forEach(btn => {
  btn.addEventListener("click", () => {
    /* visual toggle */
    btn.parentElement.querySelectorAll(".js-nights")
       .forEach(b => b.classList.remove("is-selected"));
    btn.classList.add("is-selected");

    /* date logic */
    setCheckout(parseInt(btn.dataset.nights));
  });
});

/* Default: if endDate empty, set to +1 night on page load */
window.addEventListener("DOMContentLoaded", () => {
  const sel = document.querySelector(".js-nights.is-selected");
  const nights = sel ? parseInt(sel.dataset.nights) : 1;
  if (!endInput.value) setCheckout(nights);
});




</script>


{% endblock %}
